<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>⏱️ 미니 스톱워치 (랩타임 포함)</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        padding: 40px;
      }
      h1 {
        margin: 0;
      }
      .time {
        font-size: 48px;
        letter-spacing: 2px;
      }
      .btns {
        display: flex;
        gap: 8px;
      }
      button {
        padding: 10px 16px;
        border: 0;
        border-radius: 10px;
        cursor: pointer;
      }
      button.primary {
        background: #222;
        color: #fff;
      }
      button.warn {
        background: #f3f3f3;
      }
      ol {
        width: 320px;
        margin: 0;
        padding-left: 24px;
      }
      li {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px solid #eee;
      }
      .small {
        color: #666;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>👧🏻 미니 스톱워치</h1>
    <div class="time" id="display">00:00.00</div>
    <div class="btns">
      <button id="toggle" class="primary">시작</button>
      <button id="lap" class="warn" disabled>랩타임</button>
      <button id="reset" class="warn" disabled>초기화</button>
    </div>

    <ol id="laps"></ol>
    <div class="small">TIP: 시작 ▶ 랩타임 여러 번 ▶ 정지 ▶ 초기화</div>

    <script>
      // 상태 변수들
      let startAt = 0; // 타이머를 시작한 시점 (ms)
      let elapsed = 0; // 누적 경과 시간 (ms)
      let timerId = null; // setInterval 핸들
      let lapIdx = 1;

      const $display = document.getElementById("display");
      const $toggle = document.getElementById("toggle");
      const $lap = document.getElementById("lap");
      const $reset = document.getElementById("reset");
      const $laps = document.getElementById("laps");

      // 숫자를 2자리로 예쁘게: 3 -> "03"
      const pad2 = (n) => String(n).padStart(2, "0");

      // ms(밀리초)를 "MM:SS.hh" 로 포맷
      function fmt(ms) {
        const total = Math.floor(ms / 10); // 10ms 단위
        const hh = total % 100; // 0~99 (센티초)
        const s = Math.floor(total / 100) % 60;
        const m = Math.floor(total / 6000);
        return `${pad2(m)}:${pad2(s)}.${pad2(hh)}`;
      }

      function render() {
        const nowElapsed = timerId ? Date.now() - startAt : elapsed;
        $display.textContent = fmt(nowElapsed);
      }

      function start() {
        startAt = Date.now() - elapsed; // 일시정지 후 재시작 대응
        timerId = setInterval(render, 10); // 0.01초마다 업데이트
        $toggle.textContent = "정지";
        $lap.disabled = false;
        $reset.disabled = false;
      }

      function stop() {
        clearInterval(timerId);
        timerId = null;
        elapsed = Date.now() - startAt;
        render();
        $toggle.textContent = "시작";
        // 정지 후에도 랩/초기화는 가능하게 유지
      }

      function reset() {
        stop(); // 안전하게 멈추고
        elapsed = 0;
        lapIdx = 1;
        $laps.innerHTML = "";
        render();
        $lap.disabled = true;
        $reset.disabled = true;
      }

      function addLap() {
        const nowElapsed = timerId ? Date.now() - startAt : elapsed;
        const li = document.createElement("li");
        li.innerHTML = `<span>#${lapIdx++}</span><span>${fmt(
          nowElapsed
        )}</span>`;
        $laps.prepend(li); // 최신 랩이 위로 오게
      }

      // 이벤트 연결
      $toggle.addEventListener("click", () => (timerId ? stop() : start()));
      $lap.addEventListener("click", addLap);
      $reset.addEventListener("click", reset);

      // 초기 렌더
      render();
    </script>
  </body>
</html>
