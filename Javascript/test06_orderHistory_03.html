<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>회원 주문내역 (JS 버전) — 달력 조회 포함</title>
    <style>
      :root {
        --brand: #dc0630;
        --bg: #fff;
        --muted: #666;
      }
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Inter, Noto Sans KR, Arial, sans-serif;
        background: linear-gradient(180deg, #fff 0%, #fff8f8 100%);
        padding: 28px;
        color: #222;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 20px;
      }
      header {
        grid-column: 1/3;
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 6px;
      }
      .logo {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: var(--brand);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 700;
      }
      .card {
        background: #fff;
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 10px 30px rgba(220, 6, 48, 0.06);
      }

      /* left: calendar */
      .calendar {
        padding: 12px;
      }
      .cal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .cal-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
      }
      .day {
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        background: #fff;
        border: 1px solid #f3eaea;
        cursor: pointer;
      }
      .day.other {
        opacity: 0.35;
      }
      .day.today {
        box-shadow: 0 0 0 3px rgba(220, 6, 48, 0.08);
        border-color: var(--brand);
      }
      .day.hasorder {
        position: relative;
      }
      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--brand);
        position: absolute;
        right: 6px;
        bottom: 6px;
      }
      .cal-controls button {
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid #eee;
        background: #fff;
      }

      /* right: table */
      .controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 12px;
      }
      .controls input {
        flex: 1;
        padding: 10px 12px;
        border: 1px solid #eee;
        border-radius: 10px;
      }
      .controls select,
      .controls button {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #eee;
        background: #fff;
      }
      .controls button.primary {
        background: var(--brand);
        color: #fff;
        border: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px 8px;
        text-align: left;
        border-bottom: 1px solid #faf0f0;
        font-size: 14px;
      }
      th {
        color: var(--muted);
        font-weight: 600;
      }
      .price {
        font-weight: 700;
        color: var(--brand);
      }
      .status {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 13px;
      }
      .status.pending {
        background: #fff0f3;
        color: var(--brand);
        border: 1px solid #ffdede;
      }
      .status.done {
        background: #f3fff8;
        color: #0a8a32;
        border: 1px solid #d6f5df;
      }

      .btn {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #eee;
        background: #fff;
        cursor: pointer;
      }

      /* modal */
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.35);
        z-index: 60;
      }
      .modal .dialog {
        background: #fff;
        padding: 18px;
        border-radius: 12px;
        max-width: 720px;
        width: 94%;
      }

      @media (max-width: 1000px) {
        .wrap {
          grid-template-columns: 1fr;
        }
        header {
          grid-column: 1/2;
        }
      }
      @media (max-width: 720px) {
        th:nth-child(3),
        td:nth-child(3),
        th:nth-child(4),
        td:nth-child(4) {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="logo">SHOP</div>
        <div>
          <h1 style="margin: 0; font-size: 20px">
            회원 주문내역 — 달력으로 조회 👧🏻
          </h1>
          <div style="color: #777; font-size: 13px">
            달력에서 날짜를 선택하면 해당 날짜의 주문만 필터링돼. 기간조회도
            가능해!
          </div>
        </div>
      </header>

      <!-- left: calendar + quick filters -->
      <aside class="card calendar">
        <div class="cal-header">
          <div style="font-weight: 600" id="calMonthTitle"></div>
          <div class="cal-controls">
            <button id="prevMonth">◀</button>
            <button id="nextMonth">▶</button>
          </div>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <div
          style="margin-top: 10px; display: flex; gap: 8px; align-items: center"
        >
          <button id="clearCal" class="btn">달력 필터 해제</button>
          <div style="flex: 1; text-align: right; color: #666; font-size: 13px">
            <strong id="calInfo">선택: 전체</strong>
          </div>
        </div>

        <hr style="margin: 12px 0" />
        <div style="font-size: 13px; color: #666">기간조회</div>
        <div style="display: flex; gap: 8px; margin-top: 8px">
          <input
            id="startDate"
            type="date"
            style="
              flex: 1;
              padding: 8px;
              border-radius: 8px;
              border: 1px solid #eee;
            "
          />
          <input
            id="endDate"
            type="date"
            style="
              flex: 1;
              padding: 8px;
              border-radius: 8px;
              border: 1px solid #eee;
            "
          />
        </div>
        <div style="margin-top: 8px; display: flex; gap: 8px">
          <button id="applyRange" class="btn primary">기간 적용</button>
          <button id="clearRange" class="btn">기간 해제</button>
        </div>
      </aside>

      <!-- right: list -->
      <main>
        <div class="card">
          <div class="controls">
            <input id="q" placeholder="주문번호 / 상품명 / 수령인 검색" />
            <select id="status">
              <option value="all">전체 상태</option>
              <option value="pending">결제대기</option>
              <option value="paid">결제완료</option>
              <option value="shipped">배송중</option>
              <option value="done">배송완료</option>
              <option value="cancel">취소/환불</option>
            </select>
            <button id="csv" class="btn">CSV</button>
            <button id="reset" class="btn">초기화</button>
          </div>

          <div style="overflow-x: auto">
            <table id="ordersTable">
              <thead>
                <tr>
                  <th>주문번호</th>
                  <th>주문일</th>
                  <th>상품/수량</th>
                  <th>금액</th>
                  <th>상태</th>
                  <th>작업</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-top: 12px;
            "
          >
            <div id="summary">전체 0건</div>
            <div style="display: flex; gap: 8px">
              <button id="prev" class="btn">이전</button>
              <button id="next" class="btn primary">다음</button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div id="modal" class="modal" aria-hidden="true">
      <div class="dialog">
        <h3 id="mTitle">주문 상세</h3>
        <div id="mBody"></div>
        <div style="text-align: right; margin-top: 12px">
          <button id="closeModal" class="btn">닫기</button>
        </div>
      </div>
    </div>

    <script>
      // 샘플 주문 데이터
      const orders = [];
      const sts = ["pending", "paid", "shipped", "done", "cancel"];
      // 생성: 최근 60일 범위에 랜덤 분포
      for (let i = 0; i < 120; i++) {
        const daysAgo = Math.floor(Math.random() * 60);
        const d = new Date();
        d.setDate(d.getDate() - daysAgo);
        const iso = d.toISOString().slice(0, 10);
        orders.push({
          id: "M" + (20254000 + i),
          date: iso,
          items: [
            {
              name: `귀여운 키링 #${i + 1}`,
              qty: Math.floor(Math.random() * 3) + 1,
            },
          ],
          total: (Math.floor(Math.random() * 120) + 15) * 1000,
          status: sts[i % sts.length],
          recipient: `김수령${i + 1}`,
        });
      }

      // 상태
      let state = {
        page: 1,
        perPage: 7,
        q: "",
        status: "all",
        calFilter: null,
        range: null,
      };
      const tbody = document.querySelector("#ordersTable tbody");
      const summary = document.getElementById("summary");
      const calGrid = document.getElementById("calGrid");
      const calMonthTitle = document.getElementById("calMonthTitle");
      const calInfo = document.getElementById("calInfo");

      // calendar current month pointer
      let calDate = new Date();
      calDate.setDate(1);

      function formatPrice(n) {
        return n.toLocaleString() + "원";
      }

      function renderStatus(s) {
        if (s === "pending")
          return `<span class="status pending">결제대기</span>`;
        if (s === "paid") return `<span class="status">결제완료</span>`;
        if (s === "shipped") return `<span class="status">배송중</span>`;
        if (s === "done") return `<span class="status done">배송완료</span>`;
        if (s === "cancel") return `<span class="status">취소/환불</span>`;
        return `<span class="status">알수없음</span>`;
      }

      function filterAndPage() {
        const q = state.q.trim().toLowerCase();
        let data = orders.filter((o) => {
          if (state.status !== "all" && o.status !== state.status) return false;
          if (state.calFilter) {
            // single date filter
            if (o.date !== state.calFilter) return false;
          }
          if (state.range) {
            // range filter {start,end}
            if (o.date < state.range.start || o.date > state.range.end)
              return false;
          }
          if (!q) return true;
          return (
            o.id.toLowerCase().includes(q) ||
            o.items.some((it) => it.name.toLowerCase().includes(q)) ||
            o.recipient.toLowerCase().includes(q)
          );
        });
        const total = data.length;
        const pages = Math.max(1, Math.ceil(total / state.perPage));
        if (state.page > pages) state.page = pages;
        const start = (state.page - 1) * state.perPage;
        const pageData = data.slice(start, start + state.perPage);
        return { data: pageData, total, pages };
      }

      function render() {
        const res = filterAndPage();
        tbody.innerHTML = "";
        res.data.forEach((o) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td><button class="btn" onclick="openDetail('${o.id}')">${
            o.id
          }</button></td>
          <td>${o.date}</td>
          <td>${o.items.map((it) => `${it.name} x${it.qty}`).join("<br>")}</td>
          <td class="price">${formatPrice(o.total)}</td>
          <td>${renderStatus(o.status)}</td>
          <td><button class="btn" onclick="reorder('${
            o.id
          }')">재주문</button></td>
        `;
          tbody.appendChild(tr);
        });
        summary.textContent = `전체 ${res.total}건 · ${state.page}/${res.pages} 페이지`;
        renderCalendar();
      }

      // ---------------- Calendar ----------------
      function renderCalendar() {
        calGrid.innerHTML = "";
        const year = calDate.getFullYear();
        const month = calDate.getMonth();
        calMonthTitle.textContent = `${year}년 ${month + 1}월`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        // days from prev month to fill
        const prevMonthDays = new Date(year, month, 0).getDate();

        // weekday headers
        const weekdays = ["일", "월", "화", "수", "목", "금", "토"];
        weekdays.forEach((w) => {
          const el = document.createElement("div");
          el.textContent = w;
          el.style.fontWeight = "600";
          el.style.textAlign = "center";
          el.style.padding = "6px 0";
          calGrid.appendChild(el);
        });

        // fill prev month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const d = prevMonthDays - i;
          const div = document.createElement("div");
          div.className = "day other";
          div.textContent = d;
          calGrid.appendChild(div);
        }

        // main days
        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = new Date(year, month, d).toISOString().slice(0, 10);
          const has = orders.some((o) => o.date === dateStr);
          const div = document.createElement("div");
          div.className = "day" + (has ? " hasorder" : "");
          div.textContent = d;
          if (has) {
            const dot = document.createElement("span");
            dot.className = "dot";
            div.appendChild(dot);
          }
          // today
          const today = new Date();
          if (
            today.getFullYear() === year &&
            today.getMonth() === month &&
            today.getDate() === d
          ) {
            div.classList.add("today");
          }
          div.addEventListener("click", () => {
            state.calFilter = dateStr;
            state.range = null;
            state.page = 1;
            calInfo.textContent = `선택: ${dateStr}`;
            render();
          });
          calGrid.appendChild(div);
        }

        // fill next month days to make grid 7 columns * rows
        const totalCells = weekdays.length + firstDay + daysInMonth;
        const rem = (7 - (totalCells % 7)) % 7;
        for (let i = 1; i <= rem; i++) {
          const div = document.createElement("div");
          div.className = "day other";
          div.textContent = i;
          calGrid.appendChild(div);
        }
      }

      document.getElementById("prevMonth").addEventListener("click", () => {
        calDate.setMonth(calDate.getMonth() - 1);
        renderCalendar();
      });
      document.getElementById("nextMonth").addEventListener("click", () => {
        calDate.setMonth(calDate.getMonth() + 1);
        renderCalendar();
      });
      document.getElementById("clearCal").addEventListener("click", () => {
        state.calFilter = null;
        state.range = null;
        calInfo.textContent = "선택: 전체";
        render();
      });

      // period apply
      document.getElementById("applyRange").addEventListener("click", () => {
        const s = document.getElementById("startDate").value;
        const e = document.getElementById("endDate").value;
        if (!s || !e) {
          alert("시작일과 종료일을 모두 선택하세요.");
          return;
        }
        if (s > e) {
          alert("시작일이 종료일보다 앞서야 합니다.");
          return;
        }
        state.range = { start: s, end: e };
        state.calFilter = null;
        state.page = 1;
        calInfo.textContent = `기간: ${s} → ${e}`;
        render();
      });
      document.getElementById("clearRange").addEventListener("click", () => {
        document.getElementById("startDate").value = "";
        document.getElementById("endDate").value = "";
        state.range = null;
        calInfo.textContent = "선택: 전체";
        render();
      });

      // controls
      document.getElementById("q").addEventListener("input", (e) => {
        state.q = e.target.value;
        state.page = 1;
        render();
      });
      document.getElementById("status").addEventListener("change", (e) => {
        state.status = e.target.value;
        state.page = 1;
        render();
      });
      document.getElementById("prev").addEventListener("click", () => {
        if (state.page > 1) {
          state.page--;
          render();
        }
      });
      document.getElementById("next").addEventListener("click", () => {
        state.page++;
        render();
      });
      document.getElementById("reset").addEventListener("click", () => {
        state = {
          page: 1,
          perPage: 7,
          q: "",
          status: "all",
          calFilter: null,
          range: null,
        };
        document.getElementById("q").value = "";
        document.getElementById("status").value = "all";
        document.getElementById("startDate").value = "";
        document.getElementById("endDate").value = "";
        calInfo.textContent = "선택: 전체";
        render();
      });

      document.getElementById("csv").addEventListener("click", () => {
        const rows = [["주문번호", "주문일", "상품", "금액", "상태", "수령인"]];
        orders.forEach((o) =>
          rows.push([
            o.id,
            o.date,
            o.items.map((it) => `${it.name} x${it.qty}`).join("|"),
            o.total,
            o.status,
            o.recipient,
          ])
        );
        const csv = rows
          .map((r) =>
            r.map((c) => '"' + String(c).replace(/"/g, '""') + '"').join(",")
          )
          .join("\n");

        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "member-orders.csv";
        a.click();
        URL.revokeObjectURL(url);
      });

      // modal/detail
      window.openDetail = function (id) {
        const o = orders.find((x) => x.id === id);
        const b = document.getElementById("mBody");
        b.innerHTML = `
        <p><strong>주문번호:</strong> ${o.id}</p>
        <p><strong>주문일:</strong> ${o.date}</p>
        <p><strong>수령인:</strong> ${o.recipient}</p>
        <p><strong>상품:</strong></p>
        <ul>${o.items
          .map((it) => `<li>${it.name} — 수량 ${it.qty}</li>`)
          .join("")}</ul>
        <p><strong>총액:</strong> ${formatPrice(o.total)}</p>
        <p><strong>상태:</strong> ${renderStatus(o.status)}</p>`;
        const m = document.getElementById("modal");
        m.style.display = "flex";
        m.setAttribute("aria-hidden", "false");
      };
      document.getElementById("closeModal").addEventListener("click", () => {
        const m = document.getElementById("modal");
        m.style.display = "none";
        m.setAttribute("aria-hidden", "true");
      });

      window.reorder = function (id) {
        alert(id + " 재주문(데모)");
      };

      // 초기 렌더
      render();
    </script>
  </body>
</html>
