<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>íšŒì› ì£¼ë¬¸ë‚´ì—­ (JS ë²„ì „) â€” ë‹¬ë ¥ ì¡°íšŒ í¬í•¨</title>
    <style>
      :root {
        --brand: #dc0630;
        --bg: #fff;
        --muted: #666;
      }
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Inter, Noto Sans KR, Arial, sans-serif;
        background: linear-gradient(180deg, #fff 0%, #fff8f8 100%);
        padding: 28px;
        color: #222;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 20px;
      }
      header {
        grid-column: 1/3;
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 6px;
      }
      .logo {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: var(--brand);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 700;
      }
      .card {
        background: #fff;
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 10px 30px rgba(220, 6, 48, 0.06);
      }

      /* left: calendar */
      .calendar {
        padding: 12px;
      }
      .cal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .cal-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
      }
      .day {
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        background: #fff;
        border: 1px solid #f3eaea;
        cursor: pointer;
      }
      .day.other {
        opacity: 0.35;
      }
      .day.today {
        box-shadow: 0 0 0 3px rgba(220, 6, 48, 0.08);
        border-color: var(--brand);
      }
      .day.hasorder {
        position: relative;
      }
      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--brand);
        position: absolute;
        right: 6px;
        bottom: 6px;
      }
      .cal-controls button {
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid #eee;
        background: #fff;
      }

      /* right: table */
      .controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 12px;
      }
      .controls input {
        flex: 1;
        padding: 10px 12px;
        border: 1px solid #eee;
        border-radius: 10px;
      }
      .controls select,
      .controls button {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #eee;
        background: #fff;
      }
      .controls button.primary {
        background: var(--brand);
        color: #fff;
        border: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px 8px;
        text-align: left;
        border-bottom: 1px solid #faf0f0;
        font-size: 14px;
      }
      th {
        color: var(--muted);
        font-weight: 600;
      }
      .price {
        font-weight: 700;
        color: var(--brand);
      }
      .status {
        display: inline-block;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 13px;
      }
      .status.pending {
        background: #fff0f3;
        color: var(--brand);
        border: 1px solid #ffdede;
      }
      .status.done {
        background: #f3fff8;
        color: #0a8a32;
        border: 1px solid #d6f5df;
      }

      .btn {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #eee;
        background: #fff;
        cursor: pointer;
      }

      /* modal */
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.35);
        z-index: 60;
      }
      .modal .dialog {
        background: #fff;
        padding: 18px;
        border-radius: 12px;
        max-width: 720px;
        width: 94%;
      }

      @media (max-width: 1000px) {
        .wrap {
          grid-template-columns: 1fr;
        }
        header {
          grid-column: 1/2;
        }
      }
      @media (max-width: 720px) {
        th:nth-child(3),
        td:nth-child(3),
        th:nth-child(4),
        td:nth-child(4) {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="logo">SHOP</div>
        <div>
          <h1 style="margin: 0; font-size: 20px">
            íšŒì› ì£¼ë¬¸ë‚´ì—­ â€” ë‹¬ë ¥ìœ¼ë¡œ ì¡°íšŒ ğŸ‘§ğŸ»
          </h1>
          <div style="color: #777; font-size: 13px">
            ë‹¬ë ¥ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ë‚ ì§œì˜ ì£¼ë¬¸ë§Œ í•„í„°ë§ë¼. ê¸°ê°„ì¡°íšŒë„
            ê°€ëŠ¥í•´!
          </div>
        </div>
      </header>

      <!-- left: calendar + quick filters -->
      <aside class="card calendar">
        <div class="cal-header">
          <div style="font-weight: 600" id="calMonthTitle"></div>
          <div class="cal-controls">
            <button id="prevMonth">â—€</button>
            <button id="nextMonth">â–¶</button>
          </div>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <div
          style="margin-top: 10px; display: flex; gap: 8px; align-items: center"
        >
          <button id="clearCal" class="btn">ë‹¬ë ¥ í•„í„° í•´ì œ</button>
          <div style="flex: 1; text-align: right; color: #666; font-size: 13px">
            <strong id="calInfo">ì„ íƒ: ì „ì²´</strong>
          </div>
        </div>

        <hr style="margin: 12px 0" />
        <div style="font-size: 13px; color: #666">ê¸°ê°„ì¡°íšŒ</div>
        <div style="display: flex; gap: 8px; margin-top: 8px">
          <input
            id="startDate"
            type="date"
            style="
              flex: 1;
              padding: 8px;
              border-radius: 8px;
              border: 1px solid #eee;
            "
          />
          <input
            id="endDate"
            type="date"
            style="
              flex: 1;
              padding: 8px;
              border-radius: 8px;
              border: 1px solid #eee;
            "
          />
        </div>
        <div style="margin-top: 8px; display: flex; gap: 8px">
          <button id="applyRange" class="btn primary">ê¸°ê°„ ì ìš©</button>
          <button id="clearRange" class="btn">ê¸°ê°„ í•´ì œ</button>
        </div>
      </aside>

      <!-- right: list -->
      <main>
        <div class="card">
          <div class="controls">
            <input id="q" placeholder="ì£¼ë¬¸ë²ˆí˜¸ / ìƒí’ˆëª… / ìˆ˜ë ¹ì¸ ê²€ìƒ‰" />
            <select id="status">
              <option value="all">ì „ì²´ ìƒíƒœ</option>
              <option value="pending">ê²°ì œëŒ€ê¸°</option>
              <option value="paid">ê²°ì œì™„ë£Œ</option>
              <option value="shipped">ë°°ì†¡ì¤‘</option>
              <option value="done">ë°°ì†¡ì™„ë£Œ</option>
              <option value="cancel">ì·¨ì†Œ/í™˜ë¶ˆ</option>
            </select>
            <button id="csv" class="btn">CSV</button>
            <button id="reset" class="btn">ì´ˆê¸°í™”</button>
          </div>

          <div style="overflow-x: auto">
            <table id="ordersTable">
              <thead>
                <tr>
                  <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                  <th>ì£¼ë¬¸ì¼</th>
                  <th>ìƒí’ˆ/ìˆ˜ëŸ‰</th>
                  <th>ê¸ˆì•¡</th>
                  <th>ìƒíƒœ</th>
                  <th>ì‘ì—…</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-top: 12px;
            "
          >
            <div id="summary">ì „ì²´ 0ê±´</div>
            <div style="display: flex; gap: 8px">
              <button id="prev" class="btn">ì´ì „</button>
              <button id="next" class="btn primary">ë‹¤ìŒ</button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div id="modal" class="modal" aria-hidden="true">
      <div class="dialog">
        <h3 id="mTitle">ì£¼ë¬¸ ìƒì„¸</h3>
        <div id="mBody"></div>
        <div style="text-align: right; margin-top: 12px">
          <button id="closeModal" class="btn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <script>
      // ìƒ˜í”Œ ì£¼ë¬¸ ë°ì´í„°
      const orders = [];
      const sts = ["pending", "paid", "shipped", "done", "cancel"];
      // ìƒì„±: ìµœê·¼ 60ì¼ ë²”ìœ„ì— ëœë¤ ë¶„í¬
      for (let i = 0; i < 120; i++) {
        const daysAgo = Math.floor(Math.random() * 60);
        const d = new Date();
        d.setDate(d.getDate() - daysAgo);
        const iso = d.toISOString().slice(0, 10);
        orders.push({
          id: "M" + (20254000 + i),
          date: iso,
          items: [
            {
              name: `ê·€ì—¬ìš´ í‚¤ë§ #${i + 1}`,
              qty: Math.floor(Math.random() * 3) + 1,
            },
          ],
          total: (Math.floor(Math.random() * 120) + 15) * 1000,
          status: sts[i % sts.length],
          recipient: `ê¹€ìˆ˜ë ¹${i + 1}`,
        });
      }

      // ìƒíƒœ
      let state = {
        page: 1,
        perPage: 7,
        q: "",
        status: "all",
        calFilter: null,
        range: null,
      };
      const tbody = document.querySelector("#ordersTable tbody");
      const summary = document.getElementById("summary");
      const calGrid = document.getElementById("calGrid");
      const calMonthTitle = document.getElementById("calMonthTitle");
      const calInfo = document.getElementById("calInfo");

      // calendar current month pointer
      let calDate = new Date();
      calDate.setDate(1);

      function formatPrice(n) {
        return n.toLocaleString() + "ì›";
      }

      function renderStatus(s) {
        if (s === "pending")
          return `<span class="status pending">ê²°ì œëŒ€ê¸°</span>`;
        if (s === "paid") return `<span class="status">ê²°ì œì™„ë£Œ</span>`;
        if (s === "shipped") return `<span class="status">ë°°ì†¡ì¤‘</span>`;
        if (s === "done") return `<span class="status done">ë°°ì†¡ì™„ë£Œ</span>`;
        if (s === "cancel") return `<span class="status">ì·¨ì†Œ/í™˜ë¶ˆ</span>`;
        return `<span class="status">ì•Œìˆ˜ì—†ìŒ</span>`;
      }

      function filterAndPage() {
        const q = state.q.trim().toLowerCase();
        let data = orders.filter((o) => {
          if (state.status !== "all" && o.status !== state.status) return false;
          if (state.calFilter) {
            // single date filter
            if (o.date !== state.calFilter) return false;
          }
          if (state.range) {
            // range filter {start,end}
            if (o.date < state.range.start || o.date > state.range.end)
              return false;
          }
          if (!q) return true;
          return (
            o.id.toLowerCase().includes(q) ||
            o.items.some((it) => it.name.toLowerCase().includes(q)) ||
            o.recipient.toLowerCase().includes(q)
          );
        });
        const total = data.length;
        const pages = Math.max(1, Math.ceil(total / state.perPage));
        if (state.page > pages) state.page = pages;
        const start = (state.page - 1) * state.perPage;
        const pageData = data.slice(start, start + state.perPage);
        return { data: pageData, total, pages };
      }

      function render() {
        const res = filterAndPage();
        tbody.innerHTML = "";
        res.data.forEach((o) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td><button class="btn" onclick="openDetail('${o.id}')">${
            o.id
          }</button></td>
          <td>${o.date}</td>
          <td>${o.items.map((it) => `${it.name} x${it.qty}`).join("<br>")}</td>
          <td class="price">${formatPrice(o.total)}</td>
          <td>${renderStatus(o.status)}</td>
          <td><button class="btn" onclick="reorder('${
            o.id
          }')">ì¬ì£¼ë¬¸</button></td>
        `;
          tbody.appendChild(tr);
        });
        summary.textContent = `ì „ì²´ ${res.total}ê±´ Â· ${state.page}/${res.pages} í˜ì´ì§€`;
        renderCalendar();
      }

      // ---------------- Calendar ----------------
      function renderCalendar() {
        calGrid.innerHTML = "";
        const year = calDate.getFullYear();
        const month = calDate.getMonth();
        calMonthTitle.textContent = `${year}ë…„ ${month + 1}ì›”`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        // days from prev month to fill
        const prevMonthDays = new Date(year, month, 0).getDate();

        // weekday headers
        const weekdays = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
        weekdays.forEach((w) => {
          const el = document.createElement("div");
          el.textContent = w;
          el.style.fontWeight = "600";
          el.style.textAlign = "center";
          el.style.padding = "6px 0";
          calGrid.appendChild(el);
        });

        // fill prev month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const d = prevMonthDays - i;
          const div = document.createElement("div");
          div.className = "day other";
          div.textContent = d;
          calGrid.appendChild(div);
        }

        // main days
        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = new Date(year, month, d).toISOString().slice(0, 10);
          const has = orders.some((o) => o.date === dateStr);
          const div = document.createElement("div");
          div.className = "day" + (has ? " hasorder" : "");
          div.textContent = d;
          if (has) {
            const dot = document.createElement("span");
            dot.className = "dot";
            div.appendChild(dot);
          }
          // today
          const today = new Date();
          if (
            today.getFullYear() === year &&
            today.getMonth() === month &&
            today.getDate() === d
          ) {
            div.classList.add("today");
          }
          div.addEventListener("click", () => {
            state.calFilter = dateStr;
            state.range = null;
            state.page = 1;
            calInfo.textContent = `ì„ íƒ: ${dateStr}`;
            render();
          });
          calGrid.appendChild(div);
        }

        // fill next month days to make grid 7 columns * rows
        const totalCells = weekdays.length + firstDay + daysInMonth;
        const rem = (7 - (totalCells % 7)) % 7;
        for (let i = 1; i <= rem; i++) {
          const div = document.createElement("div");
          div.className = "day other";
          div.textContent = i;
          calGrid.appendChild(div);
        }
      }

      document.getElementById("prevMonth").addEventListener("click", () => {
        calDate.setMonth(calDate.getMonth() - 1);
        renderCalendar();
      });
      document.getElementById("nextMonth").addEventListener("click", () => {
        calDate.setMonth(calDate.getMonth() + 1);
        renderCalendar();
      });
      document.getElementById("clearCal").addEventListener("click", () => {
        state.calFilter = null;
        state.range = null;
        calInfo.textContent = "ì„ íƒ: ì „ì²´";
        render();
      });

      // period apply
      document.getElementById("applyRange").addEventListener("click", () => {
        const s = document.getElementById("startDate").value;
        const e = document.getElementById("endDate").value;
        if (!s || !e) {
          alert("ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.");
          return;
        }
        if (s > e) {
          alert("ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ì•ì„œì•¼ í•©ë‹ˆë‹¤.");
          return;
        }
        state.range = { start: s, end: e };
        state.calFilter = null;
        state.page = 1;
        calInfo.textContent = `ê¸°ê°„: ${s} â†’ ${e}`;
        render();
      });
      document.getElementById("clearRange").addEventListener("click", () => {
        document.getElementById("startDate").value = "";
        document.getElementById("endDate").value = "";
        state.range = null;
        calInfo.textContent = "ì„ íƒ: ì „ì²´";
        render();
      });

      // controls
      document.getElementById("q").addEventListener("input", (e) => {
        state.q = e.target.value;
        state.page = 1;
        render();
      });
      document.getElementById("status").addEventListener("change", (e) => {
        state.status = e.target.value;
        state.page = 1;
        render();
      });
      document.getElementById("prev").addEventListener("click", () => {
        if (state.page > 1) {
          state.page--;
          render();
        }
      });
      document.getElementById("next").addEventListener("click", () => {
        state.page++;
        render();
      });
      document.getElementById("reset").addEventListener("click", () => {
        state = {
          page: 1,
          perPage: 7,
          q: "",
          status: "all",
          calFilter: null,
          range: null,
        };
        document.getElementById("q").value = "";
        document.getElementById("status").value = "all";
        document.getElementById("startDate").value = "";
        document.getElementById("endDate").value = "";
        calInfo.textContent = "ì„ íƒ: ì „ì²´";
        render();
      });

      document.getElementById("csv").addEventListener("click", () => {
        const rows = [["ì£¼ë¬¸ë²ˆí˜¸", "ì£¼ë¬¸ì¼", "ìƒí’ˆ", "ê¸ˆì•¡", "ìƒíƒœ", "ìˆ˜ë ¹ì¸"]];
        orders.forEach((o) =>
          rows.push([
            o.id,
            o.date,
            o.items.map((it) => `${it.name} x${it.qty}`).join("|"),
            o.total,
            o.status,
            o.recipient,
          ])
        );
        const csv = rows
          .map((r) =>
            r.map((c) => '"' + String(c).replace(/"/g, '""') + '"').join(",")
          )
          .join("\n");

        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "member-orders.csv";
        a.click();
        URL.revokeObjectURL(url);
      });

      // modal/detail
      window.openDetail = function (id) {
        const o = orders.find((x) => x.id === id);
        const b = document.getElementById("mBody");
        b.innerHTML = `
        <p><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> ${o.id}</p>
        <p><strong>ì£¼ë¬¸ì¼:</strong> ${o.date}</p>
        <p><strong>ìˆ˜ë ¹ì¸:</strong> ${o.recipient}</p>
        <p><strong>ìƒí’ˆ:</strong></p>
        <ul>${o.items
          .map((it) => `<li>${it.name} â€” ìˆ˜ëŸ‰ ${it.qty}</li>`)
          .join("")}</ul>
        <p><strong>ì´ì•¡:</strong> ${formatPrice(o.total)}</p>
        <p><strong>ìƒíƒœ:</strong> ${renderStatus(o.status)}</p>`;
        const m = document.getElementById("modal");
        m.style.display = "flex";
        m.setAttribute("aria-hidden", "false");
      };
      document.getElementById("closeModal").addEventListener("click", () => {
        const m = document.getElementById("modal");
        m.style.display = "none";
        m.setAttribute("aria-hidden", "true");
      });

      window.reorder = function (id) {
        alert(id + " ì¬ì£¼ë¬¸(ë°ëª¨)");
      };

      // ì´ˆê¸° ë Œë”
      render();
    </script>
  </body>
</html>
